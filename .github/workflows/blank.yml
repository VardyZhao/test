# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v4

      # Runs a single command using the runners shell
      - name: Run a one-line script
        run: echo Hello, world!

      # Runs a set of commands using the runners shell
      - name: check
        run: |
          php -r '
<?php
# function extractErrorCodesFromHtml($html) {
#     $codes = [];
#     $dom = new DOMDocument();
#     @$dom->loadHTML($html);
#     $xpath = new DOMXPath($dom);
#     $rows = $xpath->query("//tr/td[1]");
#     foreach ($rows as $row) {
#         $code = trim($row->textContent);
#         if (is_numeric($code)) {
#             $codes[] = $code;
#         }
#     }
#     return array_unique($codes);
# }

# // 从文件中读取错误码
# $newCodes = array_map('trim', file("error_codes.txt"));
# $newCodes = array_unique($newCodes);

# // 读取 Confluence 数据
# $confluenceData = json_decode(file_get_contents("confluence_data.json"), true);
# $htmlContent = $confluenceData["body"]["storage"]["value"];
# $existingCodes = extractErrorCodesFromHtml($htmlContent);
$newCodes = [1,2];
$existingCodes = [2,3];
// 比较错误码
$duplicates = array_intersect($newCodes, $existingCodes);
if (count($duplicates) > 0) {
    echo "Error: Detected new error codes in README.md that already exist in Confluence: " . implode(", ", $duplicates) . "\n";
    exit(1);
} else {
    echo "No conflicting error codes detected.\n";
}
'  

